<h1>{{title}}</h1>
<div class="left">
  <h2>My Heroes</h2>
  <div>
    <ul class="heroes">
      <li *ngFor="let hero of heroes"
          [class.selected]="hero === selectedHero"
          (click)="onSelect(hero)">
        <span class="badge">{{hero.id}}</span> {{hero.name}}: <b>{{hero.character}}</b>
      </li>
    </ul>
  </div>
</div>

<div *ngIf="selectedHero" class="right">
  <h2>{{selectedHero.name}}</h2>
  <div>
    <label>Weapon: </label>
    <select name="getWeapon" [(ngModel)]="selectedWeapon" (blur)="passIndex($event.target.value)">
      <option *ngFor="let wl of weapons" [ngValue]="wl" selected='{{selectedWeaponDefault}}'>
        {{wl.weapon}}
      </option>
    </select>
  </div>
  <div *ngIf="selectedWeapon">
    <p class="note">
      Fumble on unmodifed roll of <i><b>{{selectedWeapon.fumble}}</b></i> or less</p>

  </div>
  <div>
    <table>
      <tr>
        <td>
          <label class="colWide">Offense Base: </label>
        </td>
        <td>
          <label class="colWide">Penalties: </label>
        </td>
        <td>
          <label class="colWide">Bonuses: </label>
        </td>
        <td>
          <label class="colWide">Actual Roll: </label>
        </td>
      </tr>
      <tr>
        <td>
          <input type="number" (blur)="onKey($event)" [(ngModel)]="selectedHero.off" placeholder="Base"/>
        </td>
        <td>
          <input type="number" (blur)="onKey($event)" [(ngModel)]="penalty" placeholder="Penalty"/>
        </td>
        <td>
          <input type="number" (blur)="onKey($event)" [(ngModel)]="advantage" placeholder="Bonus"/>
        </td>
        <td>
          <input type="number" (blur)="onKey($event)" [(ngModel)]="roll" placeholder="Roll"/>
        </td>
      </tr>
    </table>
  </div>

  <div>
    <label class="atLabel">Attack Table: </label>
    <select [(ngModel)]="selectedHero.at">
      <option *ngFor="let at of atList" value={{at.id}}>
        {{at.id}}
      </option>
    </select>
  </div>
  <div class="wideLabel" *ngIf="selectedWeapon">
    <p class="Big veryWide">The attack result is: <b>{{attackValue}}</b></p>
    <p class="wideLabel small veryWide"><i>{{selectedWeapon.table}}[{{attackIndex}}][{{selectedHero.at}}]</i></p>
  </div>


  <div *ngIf="weapTable">
    <p class="note">The combat results are: </p>
    <div *ngIf="selectedWeapon">
      <table>
        <tr>
          <td>
            <p class="wideLabelIndent Big Red" *ngIf="roll <= selectedWeapon.fumble"><b>FUMBLE!</b></p>
          </td>
        </tr>
        <tr>
          <td>
            <p class="wideLabelIndent Big">Hits: <b>{{weapTable[attackIndex][selectedHero.at].hits}}</b></p><br>
            <p class="wideLabelIndent Red" *ngIf="weapTable[attackIndex][selectedHero.at].hits == 0"> Miss!</p>
            <p class="wideLabelIndent Red" *ngIf="weapTable[attackIndex][selectedHero.at].hits > 0"> Hit!</p>
          </td>

        </tr>
        <tr>
          <td>
            <p class="wideLabelIndent Big">Critical Level:
              <b>{{weapTable[attackIndex][selectedHero.at].critical_level}}</b></p>
          </td>
        </tr>
        <tr>
          <td>
            <p class="wideLabelIndent Big">Critical Type:
              <b>{{weapTable[attackIndex][selectedHero.at].critical_type}}</b></p><br>
            <p class="wideLabelIndent Red" *ngIf="'' != weapTable[attackIndex][selectedHero.at].critical_type"><b>{{getCritType(weapTable[attackIndex][selectedHero.at].critical_type)}}</b>
            </p>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <!--  <div *ngIf="weapTable">
        <div>
          <p>Trying to get just a single weapon with index [{{attackRow}},{{attackType}}]:<br>
            Hits: {{weapTable[attackRow][attackType].hits}}<br>
            Critical Level: {{weapTable[85][5].critical_level}}<br>
            Critical Type: {{weapTable[85][5].critical_type}}<br>
          </p>
        </div>
        <template ngFor [ngForOf]="weapTable" let-w let-j="index">
          <li class="weapons" *ngFor="let a of w; let i = index">
            <span class="badge">{{j}}, {{i}} </span>Hits: {{a.hits}} Critical Level: {{a.critical_level}}, Critical Type:
            [{{a.critical_type}}]
          </li>
        </template>
      </div>-->
</div>



